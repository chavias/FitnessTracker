{% extends 'layout.html' %}

{% block header %}
<script>
    function addExerciseRow() {
        const exerciseList = document.getElementById('exercise-list');
        const newIndex = exerciseList.children.length;

        // Create a new row
        const newRow = document.createElement('div');
        newRow.classList.add('exercise-row');

        // Add input fields and a hidden CSRF token field
        newRow.innerHTML = `
            <input type="text" name="exercises-${newIndex}-exercise_name" placeholder="Exercise Name" required>
            <input type="hidden" name="exercises-${newIndex}-csrf_token" value="${document.querySelector('input[name="csrf_token"]').value}">
            <button type="button" onclick="removeExerciseRow(this)">&#10006;</button>
        `;
        exerciseList.appendChild(newRow);
    }


    function removeExerciseRow(button) {
        const row = button.parentElement;
        row.remove();
    }
</script>
{% endblock %}

{% block content %}
<form method="POST">
    {{ form.hidden_tag() }}
    <input type="text" name="template_name" 
        value="{{ form.template_name.data or '' }}" 
        placeholder="{{ form.template_name.label.text }}" 
        size="40" required><br><br>

    <div id="exercise-list">
        {% for subform in form.exercises %}
            <div class="exercise-row">
                <input type="text" name="exercises-{{ loop.index0 }}-exercise_name" 
                    value="{{ subform.exercise_name.data or '' }}" 
                    placeholder="Exercise Name" required>
                    {{ subform.csrf_token }}
                <button type="button" onclick="removeExerciseRow(this)">&#10006;</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" onclick="addExerciseRow()">Add Exercise</button><br><br>
    <button type="submit" name="submit" value="true">Create Template</button>
</form>


<!-- Template Section (Optional for Display) -->
<div class="template-section">
    <ul class="template-list">
        {% if templates %}
            {% for template in templates %}
                <li>
                    <strong>{{ template.name }}</strong>
                    <ul>
                        {% for exercise in template_data[template.id] %}
                            <li>{{ exercise }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        {% else %}
            <li class="no-templates">No templates found.</li>
        {% endif %}
    </ul>
</div>
{% endblock %}
