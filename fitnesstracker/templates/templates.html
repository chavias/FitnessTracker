{% extends 'layout.html' %}

{% block header %}
<script>
    function addExerciseRow() {
        const exerciseList = document.getElementById('exercise-list');
        const newIndex = exerciseList.children.length;

        // Create a new row
        const newRow = document.createElement('div');
        newRow.classList.add('exercise-row');

        // Add input fields and a hidden CSRF token field
        newRow.innerHTML = `
            <input type="text" name="exercises-${newIndex}-exercise_name" placeholder="Exercise Name" required>
            <input type="hidden" name="exercises-${newIndex}-csrf_token" value="${document.querySelector('input[name="csrf_token"]').value}">
            <button type="button" onclick="removeExerciseRow(this)">&#10006;</button>
        `;
        exerciseList.appendChild(newRow);
    }

    function removeExerciseRow(button) {
        const row = button.parentElement;
        row.remove();
    }
</script>
{% endblock %}

{% block content %}
<form method="POST">
    {{ form.hidden_tag() }}

    <!-- Template Name -->
    <div class="form-group">
        <label for="template_name">{{ form.template_name.label }}</label>
        <input type="text" name="template_name" 
            value="{{ form.template_name.data or '' }}" 
            placeholder="{{ form.template_name.label.text }}" 
            size="40" required>
    </div>

    <!-- Exercises List -->
    <div id="exercise-list">
        {% for subform in form.exercises %}
            <div class="exercise-row">
                <input type="text" name="exercises-{{ loop.index0 }}-exercise_name" 
                    value="{{ subform.exercise_name.data or '' }}" 
                    placeholder="Exercise Name" required>
                {{ subform.csrf_token }}
                <button type="button" onclick="removeExerciseRow(this)">&#10006;</button>
            </div>
        {% endfor %}
    </div>

    <!-- Add Exercise Button -->
    <button type="button" onclick="addExerciseRow()">Add Exercise</button><br><br>

    <!-- Submit Button -->
    <button type="submit" name="submit" value="true">Create Template</button>
</form>

<!-- Display Templates Section -->
<!-- {% if templates %}
    <div class="template-section">
        <ul class="template-list">
            {% for template in templates %}
                <li>
                    <strong>{{ template.name }}</strong>
                    <ul>
                        {% for exercise in template_data[template.id] %}
                            <li>{{ exercise }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    </div>
{% else %}
    <p>No templates found.</p>
{% endif %} -->


{% for template in templates %}
<article class="media content-section">
  <div class="media-body">
    <div class="article-metadata">
        <a class="article-title" href="{{ url_for('template', template_id=template.id) }}">{{ template.name }}</a>
    </div>
    <p class="article-content">
        {% for exercise in template_data[template.id] %}
            <li>{{ exercise }}</li>
        {% endfor %}
    </p>
  </div>
</article>
{% endfor %}


{% endblock %}